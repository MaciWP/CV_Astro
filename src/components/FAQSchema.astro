---
/**
 * FAQSchema.astro - Structured data for FAQ section
 * Enables rich FAQ snippets in Google search results
 *
 * Usage:
 * <FAQSchema faqs={[
 *   { question: "Your question?", answer: "Your answer." }
 * ]} lang="en" />
 */

interface FAQ {
  question: string;
  answer: string;
}

interface Props {
  faqs: FAQ[];
  lang?: string;
}

const { faqs, lang = 'en' } = Astro.props;

const faqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": faqs.map(faq => ({
    "@type": "Question",
    "name": faq.question,
    "acceptedAnswer": {
      "@type": "Answer",
      "text": faq.answer
    }
  }))
};

// Translations for section title
const titles: Record<string, string> = {
  en: "Frequently Asked Questions",
  es: "Preguntas Frecuentes",
  fr: "Questions Fréquentes",
  de: "Häufig gestellte Fragen"
};

const title = titles[lang] || titles.en;
---

<section class="mt-16 mb-8 faq-section">
  <div class="flex items-center mb-6 section-header">
    <div class="w-10 h-10 flex items-center justify-center bg-brand-red text-white rounded-none section-icon">
      <i class="fas fa-question-circle" aria-hidden="true"></i>
    </div>
    <h2 class="text-2xl font-bold ml-3">{title}</h2>
  </div>

  <div class="space-y-4">
    {faqs.map((faq, index) => (
      <div
        class="faq-item bg-light-surface dark:bg-dark-surface p-5 border border-light-border dark:border-dark-border rounded-none hover:border-brand-red/30 dark:hover:border-brand-red/30 hover:shadow-md transition-all duration-150"
        style={`--delay: ${100 * index}ms`}
      >
        <h3 class="font-bold text-lg mb-2">{faq.question}</h3>
        <div>
          <p class="text-light-text-secondary dark:text-dark-text-secondary">{faq.answer}</p>
        </div>
      </div>
    ))}
  </div>
</section>

<style>
    /* Initial state - hidden */
    .section-header,
    .faq-item {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 200ms ease-out, transform 200ms ease-out, box-shadow 150ms ease-out;
        transition-delay: var(--delay, 0ms);
    }

    /* Theme transitions - use CSS variable for sync with global theme */
    .faq-item {
        transition: opacity 200ms ease-out, transform 200ms ease-out, box-shadow 150ms ease-out,
                    background-color var(--theme-transition-duration, 100ms) ease-out,
                    border-color var(--theme-transition-duration, 100ms) ease-out,
                    color var(--theme-transition-duration, 100ms) ease-out;
    }

    /* Visible state */
    .faq-section.visible .section-header,
    .faq-section.visible .faq-item {
        opacity: 1;
        transform: translateY(0);
    }
</style>

<script>
    function initFAQSection() {
        const sections = document.querySelectorAll('.faq-section:not(.initialized)');

        sections.forEach(section => {
            section.classList.add('initialized');

            // IntersectionObserver for scroll animation
            const observer = new IntersectionObserver(
                (entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('visible');
                            observer.disconnect();
                        }
                    });
                },
                { threshold: 0.1 }
            );

            observer.observe(section);
        });
    }

    // Run when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initFAQSection);
    } else {
        initFAQSection();
    }

    // Re-run on Astro page transitions
    document.addEventListener('astro:page-load', initFAQSection);
</script>

<Fragment set:html={`<script type="application/ld+json">${JSON.stringify(faqSchema)}</script>`} />
