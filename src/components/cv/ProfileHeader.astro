---
import headerData from "../../data/header";
import enTranslations from "../../data/locales/en/translation.json";
import esTranslations from "../../data/locales/es/translation.json";
import frTranslations from "../../data/locales/fr/translation.json";
import deTranslations from "../../data/locales/de/translation.json";

interface Props {
    lang?: string;
}

const { lang = "en" } = Astro.props;

// Helper to get translations safely
const getTranslation = (key: string, fallback: string) => {
    let translations: any = enTranslations;
    if (lang === "es") translations = esTranslations;
    if (lang === "fr") translations = frTranslations;
    if (lang === "de") translations = deTranslations;

    const keys = key.split(".");
    let value = translations;
    for (const k of keys) {
        if (value && typeof value === "object" && k in value) {
            value = value[k];
        } else {
            return fallback;
        }
    }
    return value || fallback;
};

// Get localized data
const jobTitle = getTranslation("header.jobTitle", headerData.jobTitle);
const summary = getTranslation("header.summary", headerData.summary);
const photoAlt = getTranslation("header.photoAlt", headerData.photoAlt);
const downloadCoverLetter = getTranslation("buttons.downloadCoverLetter", "Download Cover Letter");

// Labels for contact info
const emailLabel = getTranslation("header.email", "Email");
const linkedinLabel = getTranslation("header.linkedin", "LinkedIn");
const githubLabel = getTranslation("header.github", "GitHub");
---

<div id="about" class="pt-4 pb-4">
    <section>
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6 items-center">
            {/* Información personal - izquierda */}
            <div class="md:col-span-8 space-y-4 order-2 md:order-1">
                <div>
                    <h1 class="text-4xl md:text-5xl font-bold mb-2">
                        {headerData.fullName}
                    </h1>
                    <h2 class="text-xl md:text-2xl text-accessible-brand-red font-semibold">
                        {jobTitle}
                    </h2>
                </div>

                <p class="text-gray-700 dark:text-gray-300 leading-relaxed text-lg max-w-2xl text-justify">
                    {summary}
                </p>

                {/* Información de contacto con iconos cuadrados */}
                <div class="flex flex-wrap gap-4 mt-2">
                    {
                        headerData.contactInfo.map((contact) => {
                            const label =
                                contact.type === "email"
                                    ? emailLabel
                                    : contact.type === "linkedin"
                                      ? linkedinLabel
                                      : contact.type === "github"
                                        ? githubLabel
                                        : contact.label;

                            return (
                                <div class="flex items-center gap-2 text-gray-700 dark:text-gray-300 group hover:translate-x-1 transition-all duration-200">
                                    <a
                                        href={
                                            contact.type === "email"
                                                ? `mailto:${contact.value}`
                                                : contact.url
                                        }
                                        target={
                                            contact.type !== "email"
                                                ? "_blank"
                                                : undefined
                                        }
                                        rel={
                                            contact.type !== "email"
                                                ? "noopener noreferrer"
                                                : undefined
                                        }
                                        class="flex items-center gap-2 hover:text-brand-red dark:hover:text-brand-red transition-colors"
                                        aria-label={label}
                                    >
                                        <div class="w-10 h-10 flex items-center justify-center text-white bg-brand-red/90 shadow-sm rounded-none group-hover:bg-brand-red transition-all duration-200">
                                            <i class={contact.icon} />
                                        </div>
                                        <div>
                                            <span class="text-xs block text-light-text-secondary dark:text-dark-text-secondary">
                                                {label}
                                            </span>
                                            {contact.value}
                                        </div>
                                    </a>
                                </div>
                            );
                        })
                    }
                </div>
            </div>

            {/* Foto profesional - derecha, con card container */}
            <div class="md:col-span-4 flex flex-col items-center md:items-end order-1 md:order-2">
                <div class="w-full max-w-xs border border-light-border dark:border-dark-border bg-light-surface dark:bg-dark-surface shadow-sm">
                    {/* Imagen - Explicit width/height to prevent CLS */}
                    <div class="w-full aspect-square" style="min-height: 280px; contain: layout size;">
                        <picture>
                            {/* Mobile AVIF - uses 640w for all DPR (preloaded in Layout.astro) */}
                            <source
                                srcset="/images/oriol_macias-640.avif"
                                media="(max-width: 767px)"
                                type="image/avif"
                            />
                            {/* Desktop AVIF - larger screens may need higher res */}
                            <source
                                srcset="/images/oriol_macias-320.avif 320w, /images/oriol_macias-640.avif 640w, /images/oriol_macias-960.avif 960w"
                                sizes="320px"
                                type="image/avif"
                            />
                            {/* WebP fallback for mobile */}
                            <source
                                srcset="/images/oriol_macias-640.webp"
                                media="(max-width: 767px)"
                                type="image/webp"
                            />
                            {/* WebP fallback for desktop */}
                            <source
                                srcset="/images/oriol_macias-320.webp 320w, /images/oriol_macias-640.webp 640w, /images/oriol_macias-960.webp 960w"
                                sizes="320px"
                                type="image/webp"
                            />
                            {/* Fallback img - uses 640w to match preload */}
                            <img
                                src="/images/oriol_macias-640.avif"
                                alt={photoAlt}
                                width="320"
                                height="320"
                                loading="eager"
                                fetchpriority="high"
                                decoding="sync"
                                class="w-full h-full object-cover"
                            />
                        </picture>
                    </div>
                    {/* Botón dentro del mismo card */}
                    <a
                        href="/OriolMacias_CoverLetter.pdf"
                        download="OriolMacias_CoverLetter.pdf"
                        target="_blank"
                        class="w-full inline-flex items-center justify-center px-3 py-3 text-sm font-medium text-white bg-brand-red hover:bg-red-700 transition-colors focus:outline-none cursor-pointer no-underline"
                        aria-label={downloadCoverLetter}
                    >
                        <i class="fas fa-file-alt mr-2"></i>
                        <span>{downloadCoverLetter}</span>
                    </a>
                </div>
            </div>
        </div>
    </section>
</div>
