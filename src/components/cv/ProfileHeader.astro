---
import headerData from "../../data/header";
import enTranslations from "../../data/locales/en/translation.json";
import esTranslations from "../../data/locales/es/translation.json";
import frTranslations from "../../data/locales/fr/translation.json";
import deTranslations from "../../data/locales/de/translation.json";
import SvgIcons from "../icons/SvgIcons.astro";

interface Props {
    lang?: string;
}

const { lang = "en" } = Astro.props;

// Helper to get translations safely
const getTranslation = (key: string, fallback: string) => {
    let translations: any = enTranslations;
    if (lang === "es") translations = esTranslations;
    if (lang === "fr") translations = frTranslations;
    if (lang === "de") translations = deTranslations;

    const keys = key.split(".");
    let value = translations;
    for (const k of keys) {
        if (value && typeof value === "object" && k in value) {
            value = value[k];
        } else {
            return fallback;
        }
    }
    return value || fallback;
};

// Get localized data
const jobTitle = getTranslation("header.jobTitle", headerData.jobTitle);
const summary = getTranslation("header.summary", headerData.summary);
const photoAlt = getTranslation("header.photoAlt", headerData.photoAlt);
const downloadCoverLetter = getTranslation("buttons.downloadCoverLetter", "Download Cover Letter");

// Swiss market fields - full versions for desktop
const dateOfBirth = headerData.dateOfBirth;
const nationality = getTranslation("header.nationality", headerData.nationality);
const workPermit = getTranslation("header.workPermit", headerData.workPermit);
const location = getTranslation("header.location", headerData.location);
const relocation = getTranslation("header.relocation", headerData.relocation);
const noticePeriod = getTranslation("header.noticePeriod", headerData.noticePeriod);

// Short versions for mobile
const nationalityShort = getTranslation("header.nationalityShort", "Spanish (EU)");
const workPermitShort = getTranslation("header.workPermitShort", "B-Permit");
const locationShort = getTranslation("header.locationShort", "Madrid");
const relocationShort = getTranslation("header.relocationShort", "Open to CH");
const noticePeriodShort = getTranslation("header.noticePeriodShort", "2 weeks");

// Labels for contact info
const emailLabel = getTranslation("header.email", "Email");
const linkedinLabel = getTranslation("header.linkedin", "LinkedIn");
const githubLabel = getTranslation("header.github", "GitHub");
---

<div id="about" class="pt-2 sm:pt-4 pb-0 sm:pb-4">
    <section>
        <div class="grid grid-cols-1 md:grid-cols-12 gap-4 sm:gap-6 items-center">
            {/* Información personal - izquierda */}
            <div class="md:col-span-8 space-y-3 sm:space-y-4 order-2 md:order-1">
                {/* Mobile: Name + Title at top */}
                <div class="sm:hidden">
                    <h1 class="text-2xl font-bold mb-1 leading-tight">
                        {headerData.fullName}
                    </h1>
                    <h2 class="text-base text-accessible-brand-red font-semibold leading-tight">
                        {jobTitle}
                    </h2>
                </div>

                {/* Mobile: Personal info + Photo side by side */}
                <div class="flex gap-1 sm:hidden items-start">
                    {/* Left: Personal info */}
                    <div class="flex-1 min-w-0 text-xs text-gray-600 dark:text-gray-400">
                        <div class="flex flex-col gap-0.5">
                            <span class="flex items-center gap-1.5">
                                <SvgIcons name="map-marker-alt" class="w-3 h-3 text-brand-red" />
                                {locationShort}
                            </span>
                            <span class="flex items-center gap-1.5">
                                <SvgIcons name="flag" class="w-3 h-3 text-brand-red" />
                                {nationalityShort}
                            </span>
                            <span class="flex items-center gap-1.5">
                                <SvgIcons name="id-card" class="w-3 h-3 text-brand-red" />
                                {workPermitShort}
                            </span>
                            <span class="flex items-center gap-1.5">
                                <SvgIcons name="calendar-alt" class="w-3 h-3 text-brand-red" />
                                {dateOfBirth}
                            </span>
                            <span class="flex items-center gap-1.5">
                                <SvgIcons name="clock" class="w-3 h-3 text-brand-red" />
                                {noticePeriodShort}
                            </span>
                            <span class="flex items-center gap-1.5">
                                <SvgIcons name="plane" class="w-3 h-3 text-brand-red" />
                                {relocationShort}
                            </span>
                        </div>
                    </div>
                    {/* Right: Photo + Download button */}
                    <div class="flex-shrink-0 w-40">
                        <div class="border border-light-border dark:border-dark-border bg-light-surface dark:bg-dark-surface shadow-sm">
                            <div class="w-full aspect-square">
                                <picture>
                                    <source
                                        srcset="/images/oriol_macias-320.webp 320w"
                                        type="image/webp"
                                    />
                                    <img
                                        src="/images/oriol_macias-320.webp"
                                        alt={photoAlt}
                                        width="128"
                                        height="128"
                                        loading="eager"
                                        class="w-full h-full object-cover"
                                    />
                                </picture>
                            </div>
                            {/* Download Cover Letter button */}
                            <a
                                href="/OriolMacias_CoverLetter.pdf"
                                download="OriolMacias_CoverLetter.pdf"
                                target="_blank"
                                class="w-full inline-flex items-center justify-center px-2 py-2 text-xs font-medium text-white bg-brand-red hover:bg-red-700 transition-colors focus:outline-none cursor-pointer no-underline"
                                aria-label={downloadCoverLetter}
                            >
                                <SvgIcons name="file-alt" class="w-3 h-3 mr-1" />
                                <span>Cover Letter</span>
                            </a>
                        </div>
                    </div>
                </div>

                {/* Desktop: Name and Title (hidden on mobile, shown on sm+) */}
                <div class="hidden sm:block">
                    <h1 class="text-4xl md:text-5xl font-bold mb-2">
                        {headerData.fullName}
                    </h1>
                    <h2 class="text-xl md:text-2xl text-accessible-brand-red font-semibold">
                        {jobTitle}
                    </h2>
                </div>

                {/* Desktop: Personal info inline with dots */}
                <div class="hidden sm:block text-sm text-gray-600 dark:text-gray-400">
                    <div class="flex flex-wrap items-center gap-x-2 gap-y-1">
                        <span class="flex items-center gap-1.5">
                            <SvgIcons name="map-marker-alt" class="w-3 h-3 text-brand-red" />
                            {location}
                        </span>
                        <span class="text-gray-400 dark:text-gray-600">•</span>
                        <span class="flex items-center gap-1.5">
                            <SvgIcons name="flag" class="w-3 h-3 text-brand-red" />
                            {nationality}
                        </span>
                        <span class="text-gray-400 dark:text-gray-600">•</span>
                        <span class="flex items-center gap-1.5">
                            <SvgIcons name="id-card" class="w-3 h-3 text-brand-red" />
                            {workPermit}
                        </span>
                        <span class="text-gray-400 dark:text-gray-600">•</span>
                        <span class="flex items-center gap-1.5">
                            <SvgIcons name="calendar-alt" class="w-3 h-3 text-brand-red" />
                            Born {dateOfBirth}
                        </span>
                        <span class="text-gray-400 dark:text-gray-600">•</span>
                        <span class="flex items-center gap-1.5">
                            <SvgIcons name="clock" class="w-3 h-3 text-brand-red" />
                            {noticePeriod}
                        </span>
                        <span class="text-gray-400 dark:text-gray-600">•</span>
                        <span class="flex items-center gap-1.5">
                            <SvgIcons name="plane" class="w-3 h-3 text-brand-red" />
                            {relocation}
                        </span>
                    </div>
                </div>

                <p class="text-gray-700 dark:text-gray-300 leading-relaxed text-lg max-w-2xl">
                    {summary}
                </p>

                {/* Contact info - stack on mobile, flex on tablet+ */}
                <div class="flex flex-col sm:flex-row sm:flex-wrap gap-3 sm:gap-4 mt-2">
                    {
                        headerData.contactInfo.map((contact) => {
                            const label =
                                contact.type === "email"
                                    ? emailLabel
                                    : contact.type === "linkedin"
                                      ? linkedinLabel
                                      : contact.type === "github"
                                        ? githubLabel
                                        : contact.label;

                            return (
                                <div class="flex items-center gap-2 text-gray-700 dark:text-gray-300 group hover:translate-x-1 transition-all duration-200">
                                    <a
                                        href={
                                            contact.type === "email"
                                                ? `mailto:${contact.value}`
                                                : contact.url
                                        }
                                        target={
                                            contact.type !== "email"
                                                ? "_blank"
                                                : undefined
                                        }
                                        rel={
                                            contact.type !== "email"
                                                ? "noopener noreferrer"
                                                : undefined
                                        }
                                        class="flex items-center gap-2 hover:text-brand-red dark:hover:text-brand-red transition-colors"
                                        aria-label={label}
                                    >
                                        <div class="w-10 h-10 flex items-center justify-center text-white bg-brand-red/90 shadow-sm rounded-none group-hover:bg-brand-red transition-all duration-200">
                                            <SvgIcons name={contact.icon} class="w-5 h-5" />
                                        </div>
                                        <div>
                                            <span class="text-xs block text-light-text-secondary dark:text-dark-text-secondary">
                                                {label}
                                            </span>
                                            {contact.value}
                                        </div>
                                    </a>
                                </div>
                            );
                        })
                    }
                </div>
            </div>

            {/* Foto profesional - derecha, hidden on mobile (shown inline instead) */}
            <div class="hidden sm:flex md:col-span-4 flex-col items-center md:items-end order-1 md:order-2">
                <div class="w-full max-w-xs border border-light-border dark:border-dark-border bg-light-surface dark:bg-dark-surface shadow-sm">
                    {/* Imagen - full size on tablet+ */}
                    <div class="w-full aspect-square" style="contain: layout size;">
                        <picture>
                            {/* WebP first - smaller than AVIF for this image (8.6KB vs 13KB) */}
                            <source
                                srcset="/images/oriol_macias-320.webp 320w, /images/oriol_macias-480.webp 480w"
                                sizes="(max-width: 639px) 280px, 320px"
                                type="image/webp"
                            />
                            {/* AVIF fallback */}
                            <source
                                srcset="/images/oriol_macias-320.avif 320w, /images/oriol_macias-480.avif 480w"
                                sizes="(max-width: 639px) 280px, 320px"
                                type="image/avif"
                            />
                            {/* Fallback img - WebP for optimal LCP */}
                            <img
                                src="/images/oriol_macias-320.webp"
                                alt={photoAlt}
                                width="320"
                                height="320"
                                loading="eager"
                                fetchpriority="high"
                                decoding="sync"
                                class="w-full h-full object-cover"
                            />
                        </picture>
                    </div>
                    {/* Botón dentro del mismo card */}
                    <a
                        href="/OriolMacias_CoverLetter.pdf"
                        download="OriolMacias_CoverLetter.pdf"
                        target="_blank"
                        class="w-full inline-flex items-center justify-center px-3 py-3 text-sm font-medium text-white bg-brand-red hover:bg-red-700 transition-colors focus:outline-none cursor-pointer no-underline"
                        aria-label={downloadCoverLetter}
                    >
                        <SvgIcons name="file-alt" class="w-4 h-4 mr-2" />
                        <span>{downloadCoverLetter}</span>
                    </a>
                </div>
            </div>
        </div>
    </section>
</div>
