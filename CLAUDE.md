# Claude Code Enhancement System - CV_Astro Project

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•    â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•
â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•      â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•
â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â•šâ•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•     â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš¨ MANDATORY FIRST ACTION - NO EXCEPTIONS ğŸš¨

BEFORE analyzing user's message â†’ EXECUTE: Skill('adaptive-meta-orchestrator')

Applies to: ALL messages (complex, simple, questions, greetings, EVERYTHING)
The orchestrator decides complexity and routes appropriately.
YOU just activate it. ALWAYS. FIRST. NO THINKING.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## ğŸš€ QUICK REFERENCE

**Top 5 Rules**: 1) Orchestrator ALWAYS first 2) Validate before claiming (`Glob`/`Grep`) 3) Ask if uncertain (<70% confidence) 4) Verify after claiming (Read to confirm) 5) Parallelize independent ops (3-5x faster)

| Task | Tool | Example | Time |
|------|------|---------|------|
| Check file | Glob | `Glob('src/components/**/*.astro')` | 85ms |
| Find component | Grep | `Grep('ResponsiveImage', type: 'astro')` | 120ms |
| Read file | Read | `Read('src/layouts/Layout.astro')` | 15ms |
| Ask user | AskUserQuestion | When confidence <70% | - |

**Key Commands**: `/astro-component`, `/i18n-add`, `/seo-check`, `/performance-check`, `/validate-claim`

---

## ğŸ¤– ORCHESTRATOR RULE (ABSOLUTE)

**ACTIVATE `adaptive-meta-orchestrator` ON EVERY USER MESSAGE - NO EXCEPTIONS**

```
Skill('adaptive-meta-orchestrator')
```

**WHY this design?**
- **Single decision point**: Orchestrator decides complexity, not you (no logic duplication)
- **Consistent routing**: All tasks through same entry point (predictable behavior)
- **Adaptive optimization**: Learns patterns over time
- **If YOU decide when to activate, YOU become the orchestrator** (anti-pattern)

**The orchestrator decides**: Trivial â†’ direct response | Complex â†’ full workflow with specialized agents

**If you violated**: STOP â†’ Recognize internally â†’ Activate orchestrator NOW â†’ Continue

---

## ğŸ¤ PROFESSIONAL OBJECTIVITY

**Prioritize technical accuracy over validating user's beliefs.**

1. Disagree when necessary (with evidence)
2. Factual analysis first (ignore emotional tone)
3. Challenge assumptions (question incorrect premises)
4. No false agreement (don't say "you're right" to be agreeable)
5. Rigorous standards (same for user's ideas and your own)

**Goal**: Objective guidance > false agreement

---

## ğŸ¯ PROJECT OBJECTIVE

**Mission**: Best programmer in the world | **Approach**: Honest metrics, root cause solutions, continuous improvement

**Core Principles**: 1) Anti-hallucination FIRST 2) Ask when uncertain (<70%) 3) Fix root causes 4) Measurable quality 5) Universal applicability

---

## ğŸ›¡ï¸ ANTI-HALLUCINATION (CRITICAL)

**Mandatory Rules**:

1. **Files**: `Glob` FIRST â†’ then claim
2. **Functions**: `Grep` FIRST â†’ then claim
3. **Ambiguity**: `AskUserQuestion` FIRST â†’ then execute
4. **Confidence <70%**: ASK, don't assume
5. **Verification**: After claiming â†’ READ/GREP to confirm

**Confidence Levels**:
- **95%+** (execute): Standard library, files already read, user-provided paths
- **70-85%** (hedge + verify): Project-specific code, config files, constructed paths
- **<70%** (ask): Ambiguous requirements, multiple interpretations, unclear intent

**Verification Loop**: Claim â†’ Read to confirm â†’ If wrong: acknowledge, retry, learn

**For complex tasks**: `/load-anti-hallucination` â†’ Comprehensive patterns

---

## âš¡ CONTEXT & OPTIMIZATION

**Context Management**: File refs (not content), adaptive windows, relevance filtering â†’ 70% token reduction
**TOON Format**: Tabular data â†’ 40-60% token savings
**Parallelization**: Multiple tool calls in ONE message â†’ 2-5x speedup for I/O

**For details**: `/load-context-management`, `/load-toon-format`

---

## ğŸ”Œ MCP SERVERS (2-10x SPEEDUP)

**4 servers**: filesystem (2x), git (3x), memory (persistent knowledge), fetch (10x cached)

| Operation | Native | MCP | Speedup | Context |
|-----------|--------|-----|---------|---------|
| Git status | 100ms | 30ms | 3x | Structured data |
| Docs (cached) | 3s | 300ms | 10x | Cached, LLM-optimized |
| Docs (first) | 3s | 2-4s | ~1x | First-time similar |
| API query | 200ms | 20ms | 10x | Direct API |

**Note**: MCP advantage = structured data + caching (not just raw speed)

---

## ğŸš€ PERFORMANCE

**Adaptive Model Selection**: Haiku (<50 complexity) = 2x faster, 10x cheaper | Sonnet (â‰¥50) = best quality

**Tool Selection**: Native tools (Read, Grep, Glob) > Bash (13x faster for file ops)

**Batch Operations**: Multiple in ONE message â†’ 3x faster (avoid network latency)

**Targets**: Simple <1s, Standard <2s, Complex <5s, 50%+ cost savings

---

## ğŸ¯ KEYWORD-BASED AUTO-ACTIVATION

CV_Astro supports **automatic skill/agent activation** based on keywords detected in your messages.

### How Auto-Activation Works

1. **Keyword Detection**: Orchestrator scans your message for technology keywords (astro, react, i18n, seo, etc.)
2. **Skill Matching**: Matches keywords against YAML frontmatter in `.claude/skills/*/SKILL.md`
3. **Agent Routing**: Routes to specialized agents based on keyword weights
4. **Context Loading**: Auto-loads project context when project-specific keywords detected

### YAML Frontmatter Format

All specialized skills/agents have activation metadata:

```yaml
---
name: astro-component-generator
description: Generate Astro components with TypeScript frontmatter and i18n support
activation:
  keywords:
    - astro component
    - create astro
    - new component
  triggers:
    - "\.astro$"
  auto_load_project: cv-astro  # Auto-load CV_Astro context
---
```

### Specialized Skills/Agents

**CV_Astro-Specific** (8 skills + 6 agents + 5 commands):
- **Skills**: astro-component-generator, astro-react-integrator, structured-data-generator, pwa-optimizer, responsive-image-optimizer, tailwind-component-builder, astro-seo-validator, lighthouse-performance-optimizer
- **Agents**: i18n-manager, astro-expert, seo-optimizer, lighthouse-optimizer, pwa-auditor, image-optimizer-agent
- **Commands**: /astro-component, /i18n-add, /seo-check, /i18n-validate, /performance-check

**Universal** (7 skills + 16 agents):
- Always available regardless of keywords

### Example Activation Flows

**Flow 1: Astro Component Creation**
```
User: "Create an Astro component for the hero section"
  â†“
Keywords detected: "astro component", "hero"
  â†“
Skills activated: astro-component-generator
  â†“
Auto-loads: /load-project cv-astro
  â†“
Generates: Component with TypeScript Props, TailwindCSS, i18n support
```

**Flow 2: i18n Translation**
```
User: "Add translation for contact form title"
  â†“
Keywords detected: "translation", "add"
  â†“
Agent activated: i18n-manager
  â†“
Auto-loads: cv-astro context
  â†“
Result: Translation added to en/es/fr locale files
```

**Flow 3: SEO Optimization**
```
User: "Optimize SEO for Swiss market"
  â†“
Keywords detected: "seo", "swiss"
  â†“
Agent activated: seo-optimizer
  â†“
Auto-loads: cv-astro context
  â†“
Validates: Structured data, meta tags, hreflang, sitemap
```

### Directory Structure

```
.claude/
â”œâ”€â”€ skills/                                      # 15 total (7 universal + 8 cv-astro)
â”‚   â”œâ”€â”€ adaptive-meta-orchestrator/              # Master orchestrator
â”‚   â”‚   â”œâ”€â”€ SKILL.md
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â””â”€â”€ agent-routing/
â”‚   â”‚           â””â”€â”€ routing-algorithm.md         # Keyword mapping logic
â”‚   â”œâ”€â”€ astro-component-generator/SKILL.md       # YAML frontmatter
â”‚   â”œâ”€â”€ astro-react-integrator/SKILL.md          # YAML frontmatter
â”‚   â”œâ”€â”€ structured-data-generator/SKILL.md       # YAML frontmatter
â”‚   â”œâ”€â”€ pwa-optimizer/SKILL.md                   # YAML frontmatter
â”‚   â”œâ”€â”€ responsive-image-optimizer/SKILL.md      # YAML frontmatter
â”‚   â”œâ”€â”€ tailwind-component-builder/SKILL.md      # YAML frontmatter
â”‚   â”œâ”€â”€ astro-seo-validator/SKILL.md             # YAML frontmatter
â”‚   â”œâ”€â”€ lighthouse-performance-optimizer/SKILL.md # YAML frontmatter
â”‚   â”œâ”€â”€ auto-discovery/SKILL.md                  # Auto-catalog tools
â”‚   â””â”€â”€ ...
â”œâ”€â”€ agents/                                      # 22 total (16 universal + 6 cv-astro)
â”‚   â”œâ”€â”€ i18n-manager.md                          # YAML frontmatter
â”‚   â”œâ”€â”€ astro-expert.md                          # YAML frontmatter
â”‚   â”œâ”€â”€ seo-optimizer.md                         # YAML frontmatter
â”‚   â”œâ”€â”€ lighthouse-optimizer.md                  # YAML frontmatter
â”‚   â”œâ”€â”€ pwa-auditor.md                           # YAML frontmatter
â”‚   â”œâ”€â”€ image-optimizer-agent.md                 # YAML frontmatter
â”‚   â””â”€â”€ ...
â”œâ”€â”€ commands/                                    # 23 total (18 universal + 5 cv-astro)
â”‚   â”œâ”€â”€ load-project.md                          # Load project context
â”‚   â”œâ”€â”€ astro-component.md                       # Quick component generation
â”‚   â”œâ”€â”€ i18n-add.md                              # Add translation
â”‚   â”œâ”€â”€ seo-check.md                             # SEO validation
â”‚   â”œâ”€â”€ i18n-validate.md                         # Translation consistency
â”‚   â”œâ”€â”€ performance-check.md                     # Lighthouse audit
â”‚   â”œâ”€â”€ validate-claim.md
â”‚   â””â”€â”€ ...
â”œâ”€â”€ docs/                                        # Reference documentation
â”‚   â”œâ”€â”€ ANTI-HALLUCINATION.md
â”‚   â”œâ”€â”€ CONTEXT-MANAGEMENT.md
â”‚   â”œâ”€â”€ TESTING-STRATEGY.md
â”‚   â””â”€â”€ ...
â””â”€â”€ projects/                                    # Project-specific context
    â””â”€â”€ cv-astro/
        â”œâ”€â”€ README.md                            # Quick overview
        â”œâ”€â”€ core/                                # Always-loaded (~1,500 tokens)
        â”‚   â”œâ”€â”€ architecture.md                  # Astro/React patterns
        â”‚   â”œâ”€â”€ i18n.md                          # Translation management
        â”‚   â”œâ”€â”€ seo.md                           # Swiss/Spanish SEO
        â”‚   â””â”€â”€ workflows.md                     # Common dev workflows
        â””â”€â”€ knowledge/                           # On-demand references
            â””â”€â”€ (future expansions)
```

### Performance Impact

| Metric | Before | After | Improvement |
|--------|--------|-------|-------------|
| Activation Time | Manual invocation | Auto-detected | **Instant** |
| Context Loading | Manual /load-project | Auto-loaded | **2-3x faster** |
| Accuracy | Generic responses | Specialized | **99%+ compliant** |
| Developer UX | Remember commands | Just describe task | **Seamless** |

---

## ğŸ›¡ï¸ SECURITY

**8 Core Rules**:

1. **NEVER commit secrets** - Scan before commit (OpenAI, GitHub, AWS, Google, Slack, Stripe patterns)
2. **Parameterized queries** - NO string concat in SQL
3. **Validate inputs** - Zod/similar sanitization
4. **Escape outputs** - Prevent XSS (use framework escaping)
5. **CSRF tokens** - State-changing requests
6. **Auth validation** - Verify JWT/session on protected routes
7. **Rate limiting** - Prevent brute force/DDoS
8. **Input length** - Prevent buffer overflow

**Quick Check**: SQL injection, XSS, path traversal, command injection, secrets, CSRF, auth, rate limiting

**For production**: `/load-security` â†’ OWASP Top 10 + expanded patterns

**Target**: <1% incidents, 95%+ secret detection

---

## ğŸ§ª TESTING

**Golden Rule**: Tests verify ROOT FUNCTIONALITY, not superficial checks

```typescript
// âŒ SUPERFICIAL
expect(validateEmail('test@example.com')).toBeTruthy();

// âœ… ROOT FUNCTIONALITY
expect(validateEmail('test@example.com')).toBe(true);
expect(validateEmail('invalid')).toBe(false);
expect(validateEmail('test@')).toBe(false);
```

**4 Rules**: 1) Generate from Given-When-Then (65-75% pass rate realistic) 2) Mutation testing (75-85% score) 3) Detect flaky tests 4) Quality gates (block if mutation <75%)

**Why**: Mutation testing detects superficial tests

**For new features**: `/load-testing-strategy` â†’ Generation + mutation + flaky detection

**Target**: 65-75% first-gen pass, 75-85% mutation score

---

## ğŸ”§ REFACTORING

**Safety Protocol**: Run tests BEFORE â†’ refactor â†’ tests AFTER â†’ must pass â†’ else ROLLBACK

**Thresholds** (SonarQube): CC >10 (refactor), >15 (critical) | Methods >50 lines (refactor), >100 (critical) | Duplication >5% (refactor), >10% (critical)

**Priority**: Duplication > Complexity > Length (Martin Fowler)

**For code reviews**: `/load-refactoring-patterns` â†’ Smell detection + safe refactoring

**Target**: 95%+ detection, 99%+ safe refactorings

---

## ğŸ’¬ USER EXPERIENCE

**Golden Rule: NO AUTO-DOCUMENTATION**

NEVER save docs without explicit request:
- âŒ Auto-create: README.md, JSDoc, API docs, diagrams
- âœ… Show on screen: Explanations, analysis, summaries
- âœ… Save when asked: "Document this", "Add JSDoc", "Update README"

**Error Messages**: `file:line - Specific error - Suggested fix` (verify file exists first with Glob)

**Progress**: TodoWrite for 3+ steps or >5s tasks (mark completed IMMEDIATELY, 1 in_progress at a time)

**Target**: 4.5/5 satisfaction, 0% unwanted docs

---

## ğŸ”„ SELF-IMPROVEMENT

**Golden Rule: PROACTIVE SUGGESTIONS**

Detect patterns (3+ occurrences, >75% confidence) â†’ Suggest: skills, agents, commands, MCPs, utils extraction

**Examples**: Glob('**/*.astro') 3x â†’ "Create /find-astro-components?" | translateText() in 3 files â†’ "Extract to i18n utils?" | Same SEO error 3x â†’ "Add SEO validation rule?"

**Timing**: Errors=immediate, Workflows=end of task, Commands=daily summary | **Limits**: Max 2/hour, 5/session, 15min between

**Target**: 60%+ acceptance, 5-10 patterns/week

---

## ğŸ› DEBUGGING

**5-Step Workflow**: 1) Reproduce issue 2) Locate error (stack trace bottom-up) 3) Trace backwards 4) Isolate cause (minimal reproduction) 5) Fix + verify (tests before/after)

**Stack Trace**: Read BOTTOM-UP for root cause

**Common Commands**: `Grep('console.log')`, `Grep('TODO|FIXME|BUG')`, `Grep('try|catch|throw')`

**Quick debug**: `/quick-debug`

---

## ğŸ“ PROJECT-SPECIFIC CONTEXT

**Purpose**: Load specialized knowledge for CV_Astro project (Astro 5.5.2 + React 18 + i18n)

### .claude/projects/cv-astro/ Structure

```
.claude/projects/cv-astro/
â”œâ”€â”€ README.md                  # Project overview & usage guide
â”œâ”€â”€ core/                      # Always-load documentation
â”‚   â”œâ”€â”€ architecture.md        # Astro/React patterns, component guidelines
â”‚   â”œâ”€â”€ i18n.md                # Translation management (en/es/fr)
â”‚   â”œâ”€â”€ seo.md                 # Swiss (Zurich) & Spanish SEO optimization
â”‚   â””â”€â”€ workflows.md           # Common development workflows
â””â”€â”€ knowledge/                 # Reference documentation (load on demand)
    â””â”€â”€ (future expansions)
```

### Loading Project Context

**Command**: `/load-project cv-astro`

**What gets loaded**:
1. **README.md** - Quick overview
2. **core/*.md** - All core documentation (architecture, i18n, SEO, workflows)
3. **Token-efficient summary** - <1,500 tokens, <2 seconds

**Auto-loading**: Skills/agents can specify `auto_load_project: cv-astro` in YAML frontmatter to automatically load context when activated

### When to Use

- Creating Astro components â†’ Auto-loaded via keyword detection
- Adding translations â†’ Auto-loaded by i18n-manager agent
- SEO optimization â†’ Auto-loaded by seo-optimizer agent
- Manual loading â†’ `/load-project cv-astro` if needed

### Benefits

- **Fast**: <2 seconds to load, ~1,500 tokens
- **Accurate**: 100% project-specific patterns
- **On-demand**: Load only when needed
- **Stack-specific**: Astro 5.5.2, React 18, TailwindCSS 3.4.1, i18next

---

## ğŸ“š AVAILABLE TOOLS

### Commands (23)

**Universal (18)**: `/tools`, `/skills`, `/agents`, `/commands`, `/validate-claim`, `/load-anti-hallucination`, `/load-context-management`, `/load-toon-format`, `/generate-from-spec`, `/load-security`, `/load-testing-strategy`, `/load-refactoring-patterns`, `/load-user-experience`, `/load-self-improvement`, `/docs`, `/claude-docs`, `/project-docs`, `/quick-debug`

**CV_Astro-specific (5)**: `/astro-component`, `/i18n-add`, `/seo-check`, `/i18n-validate`, `/performance-check`

---

### Skills (15)

**Universal (7)**: adaptive-meta-orchestrator, skill-builder, task-router, code-analyzer, orchestrator-observability, spec-architect-agent, utils-builder, persistent-memory

**CV_Astro-specific (8)**: astro-component-generator, astro-react-integrator, structured-data-generator, pwa-optimizer, responsive-image-optimizer, tailwind-component-builder, astro-seo-validator, lighthouse-performance-optimizer

---

### Agents (22)

**Universal (16)**: context-detector, complexity-analyzer, question-generator, quality-validator, pattern-learner, task-decomposer, test-generator, security-scanner, performance-profiler, refactor-planner, bug-documenter, decision-documenter, progress-tracker, frontend-expert, backend-expert, code-quality

**CV_Astro-specific (6)**: i18n-manager, astro-expert, seo-optimizer, lighthouse-optimizer, pwa-auditor, image-optimizer-agent

**Invocation syntax**:
```typescript
Task({
  subagent_type: 'i18n-manager',
  description: 'Add translation to all locales',
  prompt: 'Add translation key "hero.title" with English text "Welcome" to en/es/fr locales',
  model: 'haiku'  // Optional: haiku (speed), sonnet (quality)
});
```

---

### MCPs (4)

| MCP | Purpose | When to Use |
|-----|---------|-------------|
| `mcp__context7__*` | Filesystem operations | File read/write/search |
| `mcp__git__*` | Git operations | Git status, diff, log |
| `mcp__memory__*` | Persistent memory | Cross-session knowledge |
| `mcp__fetch__*` | Web fetching (cached) | Documentation access |

**Note**: MCPs provide structured data and caching benefits.

---

## ğŸ”„ ORCHESTRATOR-DRIVEN WORKFLOWS

**CRITICAL**: ALL workflows start with `adaptive-meta-orchestrator` (automatic, per ORCHESTRATOR RULE). The orchestrator analyzes your request, detects keywords, and executes the appropriate workflow using commands, agents, and skills.

### Universal Pattern (ALL Requests)

```
User: "Any request"
  â†“
adaptive-meta-orchestrator (ALWAYS FIRST - automatic)
  â†“
Phase 0: Context Loading & Prompt Analysis
  - Agent: context-detector (analyze what context is needed)
  - Load relevant knowledge:
    * /load-anti-hallucination (if files/functions mentioned)
    * /load-testing-strategy (if "test", "coverage" detected)
    * /load-security (if "security", "audit", "deploy" detected)
    * /load-refactoring-patterns (if "refactor", "improve" detected)
    * /load-project cv-astro (if CV_Astro keywords detected)
  â†“
Phase 1: Keyword Analysis
  - Keywords detected (astro, react, i18n, seo, performance, etc.)
  - Priority weights (CRITICAL > HIGH > MEDIUM > LOW)
  - Match against YAML frontmatter
  â†“
Phase 2: Complexity Scoring (0-100)
  - Determine tool type needed
  - Score based on task scope and dependencies
  â†“
Phase 3: Workflow Decision
  - Select tools (commands, agents, skills)
  - Determine execution strategy (sequential, parallel, hybrid)
  - Plan validation steps
  â†“
Phase 4: Execution & Validation
  - Execute workflow with selected tools
  - Apply skills validation
  - Verify results
```

### Example 1: Create Astro Component

```
User: "Create an Astro component for the contact form with i18n"
  â†“
adaptive-meta-orchestrator
  â†“
Keywords detected: "astro component", "i18n"
Complexity: 45/100 (medium)
  â†“
Orchestrator workflow:
  1. Auto-load: /load-project cv-astro (auto_load_project: cv-astro)
  2. Skill: astro-component-generator (generate component)
  3. Validates: TypeScript Props interface, TailwindCSS patterns
  4. Adds: i18n integration with t() helper
  5. Creates: src/components/ContactForm.astro
  â†“
Result: Component created with full i18n support
```

### Example 2: Add Translation

```
User: "Add translation for the hero section title in all languages"
  â†“
adaptive-meta-orchestrator
  â†“
Keywords detected: "translation", "add", "languages"
Complexity: 35/100 (low-medium)
  â†“
Orchestrator workflow:
  1. Auto-load: cv-astro context
  2. Agent: i18n-manager (manage translations)
  3. Prompts for: English text, context
  4. Generates: Spanish (es-ES) and French (Swiss French) translations
  5. Updates: public/locales/{en,es,fr}/common.json
  6. Validates: JSON syntax, no duplicates
  â†“
Result: Translation added to all 3 locales
```

### Example 3: SEO Optimization for Swiss Market

```
User: "Optimize SEO for Switzerland with structured data"
  â†“
adaptive-meta-orchestrator
  â†“
Keywords detected: "seo", "switzerland", "structured data"
Complexity: 65/100 (medium-high)
  â†“
Orchestrator workflow:
  1. Auto-load: /load-project cv-astro
  2. Agent: seo-optimizer (comprehensive SEO audit)
  3. Skill: structured-data-generator (Person schema with Zurich address)
  4. Validates: Meta tags, hreflang (en/es/fr), canonical URLs
  5. Checks: Sitemap completeness
  6. Command: /seo-check (final validation)
  â†“
Result: Full SEO optimization + validation report
```

### Example 4: Performance Optimization

```
User: "Optimize Lighthouse score, especially LCP"
  â†“
adaptive-meta-orchestrator
  â†“
Keywords detected: "lighthouse", "lcp", "optimize"
Complexity: 70/100 (high)
  â†“
Orchestrator workflow:
  1. Auto-load: cv-astro context
  2. Command: /performance-check (run Lighthouse audit)
  3. Agent: lighthouse-optimizer (analyze metrics)
  4. Identifies: Large unoptimized images, no preload for hero
  5. Skill: responsive-image-optimizer (generate WebP)
  6. Adds: <link rel="preload"> for LCP image
  7. Re-runs: Lighthouse audit
  â†“
Result: LCP improved from 4.2s to 1.8s, score 92/100
```

### Orchestrator Decision Logic

The orchestrator analyzes requests through 4 independent phases:

**Phase 1: Keyword Analysis**
- Scans user message for technology/domain keywords
- Assigns priority weights: CRITICAL (security, deploy) > HIGH (performance, SEO) > MEDIUM (i18n, components) > LOW (style, formatting)
- Matches detected keywords against `activation:` YAML frontmatter in skills/agents
- Determines if project context auto-loading required (`auto_load_project: cv-astro`)

**Phase 2: Complexity Scoring (0-100)**

Determines *what tools* to use, not *how* to execute:

| Score | Response Type | Tool Selection | Example |
|-------|---------------|----------------|---------|
| 0-20 | Direct answer | None | "What is Astro?" â†’ Text response |
| 21-40 | Skill validation | 1 skill | "Check this SEO" â†’ astro-seo-validator |
| 41-60 | Single agent | 1 agent + skills | "Add translation" â†’ i18n-manager |
| 61-80 | Multiple agents | 2-3 agents | "Optimize SEO + performance" â†’ seo + lighthouse |
| 81-100 | Agent cascade | 3+ agents + validation | "Full site audit" â†’ SEO + PWA + performance + i18n |

**Phase 3: Tool Selection**

Based on task nature (independent of complexity):

- **Commands**: Quick checks, validations (â‰¤30s execution)
  - `/seo-check`, `/performance-check`, `/i18n-validate`
- **Skills**: Validation rules, pattern enforcement (no heavy computation)
  - `astro-component-generator`, `structured-data-generator`, `pwa-optimizer`
- **Agents**: Complex tasks, analysis (>30s execution)
  - `i18n-manager`, `seo-optimizer`, `lighthouse-optimizer`

**Phase 4: Execution Strategy**

Determined by *task dependencies* and *work volume* (independent of complexity):

| Strategy | When to Use | Rationale | Example |
|----------|-------------|-----------|---------|
| **Sequential** | Tasks have dependencies | Step N needs output from Step N-1 | Generate component â†’ Add i18n â†’ Validate |
| **Parallel** | Tasks are independent + high volume | No shared state, can run simultaneously | SEO + Performance + PWA + i18n audits |
| **Hybrid** | Mix of dependencies | Some sequential, some parallel | Load context (seq) â†’ Run 3 audits (parallel) â†’ Report (seq) |

**Examples of Execution Strategy Decision:**

```
High complexity (85) + Independent tasks â†’ Parallel
  "Audit entire site"
  â†’ Run 4 agents in parallel (SEO, performance, PWA, i18n)

High complexity (85) + Sequential dependencies â†’ Sequential
  "Implement new page with SEO"
  â†’ Generate component (seq) â†’ Add SEO schema (seq) â†’ Validate (seq)

Medium complexity (50) + High volume â†’ Parallel
  "Optimize all images"
  â†’ Run responsive-image-optimizer for all images in parallel

Low complexity (30) + Single task â†’ Direct
  "Add translation for button"
  â†’ i18n-manager agent (single operation)
```

**Key Principle**: Complexity determines *tool type*, task structure determines *execution strategy*.

---

## âœ… SUCCESS CRITERIA

**Performance**: 2-5x speedup (routine tasks), native tools > Bash, parallelization applied

**Quality**: Zero linting/TS errors, tests pass, CC <10, methods <50 lines

**Anti-Hallucination**: Files/functions verified, confidence assessed, <5% hallucination rate

**Testing**: 65-75% first-gen pass, 75-85% mutation score, root functionality verified

**Security**: 95%+ secret detection, <1% incidents, OWASP Top 10 applied

**Documentation**: AI_*.md updated when applicable, 0% unwanted docs

**Root Cause**: Addressed (not superficial), proactive improvements proposed, 4.5/5 satisfaction

---

**System Version**: 3.0.0 (CV_Astro Specialized)
**Purpose**: CV_Astro Project Enhancement System
**Stack**: Astro 5.5.2 + React 18 + TypeScript + TailwindCSS 3.4.1 + i18next
**Markets**: Switzerland (Zurich) ğŸ‡¨ğŸ‡­ + Spain ğŸ‡ªğŸ‡¸
**Scope**: Astro SSG, React islands, i18n, SEO optimization, PWA, performance
