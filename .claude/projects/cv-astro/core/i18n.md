# i18n Management - CV_Astro

## Overview

**Library**: i18next + astro-i18next
**Supported Locales**: en (English), es (Spanish), fr (French)
**Default Locale**: en (no prefix in URL)

---

## Configuration

### Astro i18n Config

**File**: `astro.config.mjs`

```javascript
i18n: {
  defaultLocale: "en",
  locales: ["en", "es", "fr"],
  routing: {
    prefixDefaultLocale: false,
    // No redirectToDefaultLocale (removed to avoid errors)
  },
}
```

**URL Structure**:
- English (default): `https://oriolmacias.dev/about`
- Spanish: `https://oriolmacias.dev/es/about`
- French: `https://oriolmacias.dev/fr/about`

---

## Translation Files

### File Structure

```
public/
└── locales/
    ├── en/
    │   ├── common.json
    │   ├── navigation.json
    │   ├── about.json
    │   └── contact.json
    ├── es/
    │   ├── common.json
    │   ├── navigation.json
    │   ├── about.json
    │   └── contact.json
    └── fr/
        ├── common.json
        ├── navigation.json
        ├── about.json
        └── contact.json
```

### Translation Key Naming

**Namespace pattern**:
```json
{
  "namespace": {
    "section": {
      "key": "Translation text"
    }
  }
}
```

**Example** - `common.json`:
```json
{
  "site": {
    "title": "Oriol Macías - Portfolio",
    "description": "Full Stack Developer specialized in modern web technologies"
  },
  "actions": {
    "readMore": "Read more",
    "downloadCV": "Download CV",
    "contactMe": "Contact me"
  },
  "labels": {
    "name": "Name",
    "email": "Email",
    "message": "Message"
  }
}
```

**Example** - `navigation.json`:
```json
{
  "menu": {
    "home": "Home",
    "about": "About",
    "experience": "Experience",
    "projects": "Projects",
    "contact": "Contact"
  },
  "footer": {
    "rights": "All rights reserved",
    "privacy": "Privacy Policy"
  }
}
```

---

## Usage in Components

### In Astro Components

```astro
---
import { t, changeLanguage } from 'i18next';

// Set language based on Astro.currentLocale
changeLanguage(Astro.currentLocale || 'en');

const title = t('common:site.title');
const description = t('common:site.description');
---

<Layout title={title} description={description}>
  <h1>{t('navigation:menu.home')}</h1>
  <p>{t('common:actions.readMore')}</p>
</Layout>
```

### In React Components

```tsx
import React from 'react';
import { useTranslation } from 'react-i18next';

const ContactForm: React.FC = () => {
  const { t } = useTranslation(['common', 'contact']);

  return (
    <form>
      <label>{t('common:labels.name')}</label>
      <input type="text" placeholder={t('contact:form.namePlaceholder')} />

      <button type="submit">
        {t('common:actions.contactMe')}
      </button>
    </form>
  );
};

export default ContactForm;
```

---

## Language Switching

### Language Switcher Component

```tsx
// src/components/LanguageSwitcher.tsx
import React from 'react';
import { useTranslation } from 'react-i18next';

interface LanguageSwitcherProps {
  currentLocale: string;
}

const LanguageSwitcher: React.FC<LanguageSwitcherProps> = ({ currentLocale }) => {
  const { i18n } = useTranslation();

  const languages = [
    { code: 'en', label: 'English' },
    { code: 'es', label: 'Español' },
    { code: 'fr', label: 'Français' }
  ];

  const handleLanguageChange = (langCode: string) => {
    i18n.changeLanguage(langCode);

    // Navigate to new locale URL
    const currentPath = window.location.pathname;
    const newPath = langCode === 'en'
      ? currentPath.replace(/^\/(es|fr)/, '')
      : `/${langCode}${currentPath.replace(/^\/(es|fr)/, '')}`;

    window.location.href = newPath;
  };

  return (
    <div className="language-switcher">
      {languages.map(lang => (
        <button
          key={lang.code}
          onClick={() => handleLanguageChange(lang.code)}
          className={currentLocale === lang.code ? 'active' : ''}
        >
          {lang.label}
        </button>
      ))}
    </div>
  );
};

export default LanguageSwitcher;
```

### Usage in Astro Page

```astro
---
import LanguageSwitcher from '../components/LanguageSwitcher.tsx';

const currentLocale = Astro.currentLocale || 'en';
---

<LanguageSwitcher currentLocale={currentLocale} client:load />
```

---

## Translation Workflows

### Adding New Translation Key

**Workflow**:
1. Add key to English (en) file first (source of truth)
2. Add same key to Spanish (es) file
3. Add same key to French (fr) file
4. Run validation: `npm run check:translations`

**Example**:
```bash
# 1. Add to public/locales/en/common.json
{
  "buttons": {
    "submit": "Submit"
  }
}

# 2. Add to public/locales/es/common.json
{
  "buttons": {
    "submit": "Enviar"
  }
}

# 3. Add to public/locales/fr/common.json
{
  "buttons": {
    "submit": "Soumettre"
  }
}

# 4. Validate
npm run check:translations
```

### Translation Validation

**Script**: `scripts/check-translations.js`

**Checks**:
- All locale files have same keys
- No missing translations
- No extra keys in non-default locales
- Consistent namespace structure

**Run**:
```bash
npm run check:translations
```

**Output**:
```
✓ All translations are complete
✓ No missing keys in es locale
✓ No missing keys in fr locale
✓ No extra keys found
```

---

## SEO Considerations

### Language-Specific Meta Tags

```astro
---
import { t, changeLanguage } from 'i18next';

const locale = Astro.currentLocale || 'en';
changeLanguage(locale);

const title = t('seo:page.about.title');
const description = t('seo:page.about.description');
---

<Layout>
  <head>
    <html lang={locale}>
    <title>{title}</title>
    <meta name="description" content={description} />

    <!-- Alternate language versions -->
    <link rel="alternate" hreflang="en" href="https://oriolmacias.dev/about" />
    <link rel="alternate" hreflang="es" href="https://oriolmacias.dev/es/about" />
    <link rel="alternate" hreflang="fr" href="https://oriolmacias.dev/fr/about" />
    <link rel="alternate" hreflang="x-default" href="https://oriolmacias.dev/about" />
  </head>
</Layout>
```

### Structured Data (JSON-LD) with i18n

```astro
---
const locale = Astro.currentLocale || 'en';

const structuredData = {
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "Oriol Macías",
  "jobTitle": t('seo:person.jobTitle'),
  "description": t('seo:person.description'),
  "url": `https://oriolmacias.dev${locale === 'en' ? '' : `/${locale}`}`,
  "inLanguage": locale
};
---

<script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
```

---

## Best Practices

### 1. Namespace Organization

**Organize by feature/page**:
```
common.json       # Site-wide translations
navigation.json   # Menu, footer, breadcrumbs
about.json        # About page specific
contact.json      # Contact page specific
seo.json          # SEO meta tags, structured data
```

### 2. Pluralization

**Use i18next pluralization**:
```json
{
  "items": {
    "one": "{{count}} item",
    "other": "{{count}} items"
  }
}
```

**Usage**:
```tsx
{t('common:items', { count: 5 })} // → "5 items"
{t('common:items', { count: 1 })} // → "1 item"
```

### 3. Interpolation

**With variables**:
```json
{
  "greeting": "Hello, {{name}}!"
}
```

**Usage**:
```tsx
{t('common:greeting', { name: 'Oriol' })} // → "Hello, Oriol!"
```

### 4. Context-Aware Translations

**Gender/formality variations**:
```json
{
  "welcome": {
    "formal": "Welcome, Mr. {{name}}",
    "informal": "Hey {{name}}!"
  }
}
```

**Usage**:
```tsx
{t('common:welcome.formal', { name: 'Smith' })}
```

---

## Swiss & Spanish Market Considerations

### Swiss Market (Multilingual)

**Switzerland** has 4 official languages:
- German (de-CH)
- French (fr-CH)
- Italian (it-CH)
- Romansh (rm-CH)

**Current support**: French (fr) covers Swiss French market

**Future expansion** (if targeting Swiss German market):
```javascript
locales: ["en", "es", "fr", "de"]
```

### Spanish Market

**Spain Spanish (es-ES)** vs **Latin American Spanish (es-MX/es-AR/etc.)**:
- Current: Generic Spanish (es) works for Spain
- Vocabulary differences: "ordenador" (ES) vs "computadora" (LATAM)

**If targeting LATAM**:
```json
{
  "computer": {
    "es-ES": "ordenador",
    "es-MX": "computadora"
  }
}
```

---

## Common i18n Errors

### ❌ Error: Missing Translation Key

**Symptom**: `[missing "en.navigation:menu.home" translation]`

**Fix**:
```bash
# Check if key exists in all locales
npm run check:translations

# Add missing key to public/locales/{lang}/{namespace}.json
```

### ❌ Error: Wrong Namespace

**Symptom**: Translation not loading

**Fix**:
```tsx
// ❌ Wrong
{t('menu.home')} // Missing namespace

// ✅ Correct
{t('navigation:menu.home')} // With namespace
```

### ❌ Error: Language Not Switching

**Symptom**: URL changes but content stays in default language

**Fix**:
```astro
---
// Add this to ALL pages
import { changeLanguage } from 'i18next';
changeLanguage(Astro.currentLocale || 'en');
---
```

---

## Testing Translations

### Manual Testing

**Steps**:
1. Start dev server: `npm run dev`
2. Visit each locale:
   - `http://localhost:4321/` (en)
   - `http://localhost:4321/es/` (es)
   - `http://localhost:4321/fr/` (fr)
3. Verify all text translates correctly
4. Check language switcher functionality

### Automated Testing

```bash
# Check translation completeness
npm run check:translations

# Check for translation consistency
npm run check
```

---

## Quick Reference

| Task | Command/File |
|------|--------------|
| Add translation | `public/locales/{lang}/{namespace}.json` |
| Validate translations | `npm run check:translations` |
| Use in Astro | `t('namespace:key')` |
| Use in React | `useTranslation(['namespace'])` |
| Change language | `changeLanguage(locale)` |
| Get current locale | `Astro.currentLocale` |
| Default locale | `en` |
| Prefixed locales | `es`, `fr` |
